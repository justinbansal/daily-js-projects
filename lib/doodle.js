// DOM Elements
const titleInput=document.getElementById('title'),locationInput=document.getElementById('location'),addBtn=document.getElementById('addDate'),submitBtn=document.getElementById('submit'),dateGroup=document.getElementById('date-group'),pollRow=document.getElementById('poll-row'),voteInput=document.getElementById('voteInput'),voteBtn=document.getElementById('submitVote'),titleHeading=document.getElementById('event-title'),locationHeading=document.getElementById('event-location');// Variables
let polls=[],pollID=0,dateID=1;// show event details
function showDetails(){polls&&(document.querySelector('.displayPolls').style.display='block')}// loop through array of polls and render them on the page
function displayPolls(){for(let a=0;a<polls[0].eventDetails.length;a+=1){const b=document.createElement('div');b.classList='pollContainer col-md-3',b.id=polls[0].eventDetails[a].id,pollRow.appendChild(b),titleHeading.innerHTML=polls[0].title,locationHeading.innerHTML=polls[0].location;const c=document.createElement('h4');b.appendChild(c),c.innerHTML=polls[0].eventDetails[a].date;const d=polls[0].eventDetails[a].voters.filter(a=>!0===a.vote);polls[0].eventDetails[a].votes=d.length;const e=document.createElement('p');e.className='votesNumber',b.appendChild(e),e.innerHTML=polls[0].eventDetails[a].votes;const f=document.createElement('label');f.className='form-check-label',f.innerHTML='Vote Yes';const g=document.createElement('INPUT');g.type='checkbox',g.className='form-check-input',g.name='voting',g.id=`checkbox${polls[0].eventDetails[a].id}`,b.appendChild(g),b.insertBefore(f,g);const h=document.createElement('ul');b.appendChild(h);for(let a=0;a<d.length;a+=1){const b=document.createElement('li');b.innerHTML=d[a].name,h.appendChild(b)}}}function countDateFields(){const a=document.querySelectorAll('input[name^="date"').length;dateID=a+1,5===dateID&&(addBtn.disabled='true')}function addDate(a){a.preventDefault(),countDateFields();const b=document.createElement('label');b.for='date',b.innerHTML='Date';const c=document.createElement('input');c.type='date',c.name='date',c.className='date',dateGroup.appendChild(b),dateGroup.appendChild(c)}function saveForm(a){a.preventDefault(),this.disabled=!0,this.disabled&&(addBtn.disabled=!0),showDetails();const b={title:titleInput.value,location:locationInput.value,eventDetails:[]},c=document.querySelectorAll('.date');// create new object for each date
for(let d=0;d<c.length;d+=1){pollID+=1;const a={};a.date=c[d].value,a.id=pollID,a.voters=[],a.votes='',b.eventDetails.push(a)}polls.push(b),localStorage.setItem('polls',JSON.stringify(polls)),displayPolls()}// update each poll with name of voter
function submitVote(){for(let a=0;a<polls[0].eventDetails.length;a+=1){const b={name:`${voteInput.value}`,vote:document.getElementById(`checkbox${polls[0].eventDetails[a].id}`).checked};polls[0].eventDetails[a].voters.push(b)}localStorage.setItem('polls',JSON.stringify(polls)),window.location.reload()}addBtn.addEventListener('click',addDate),submitBtn.addEventListener('click',saveForm),voteBtn.addEventListener('click',submitVote);function initialize(){const a=JSON.parse(localStorage.getItem('polls'));a&&(polls=a,pollID=polls.length,showDetails(),displayPolls())}initialize();